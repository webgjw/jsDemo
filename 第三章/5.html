<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>å½±ç¢Ÿç§Ÿèµç³»ç»Ÿ</title>
</head>
<body>
<script type="text/javascript">
    /*
         ä¿®æ”¹æœ¬ç« çš„å½±ç¢Ÿç§Ÿèµç¨‹åºï¼Œå½“ä¸€éƒ¨å½±ç‰‡æ£€å‡ºåï¼Œå°†å…¶åŠ å…¥ä¸€ä¸ªå·²ç§Ÿå½±ç‰‡åˆ—è¡¨ã€‚æ¯å½“æœ‰å®¢
        æˆ·æ£€å‡ºä¸€éƒ¨å½±ç‰‡ï¼Œéƒ½æ˜¾ç¤ºè¯¥åˆ—è¡¨ä¸­çš„å†…å®¹ã€‚
    */
    function List() {
        this.listSize = 0;
        this.pos = 0;
        this.dataStore = []; // åˆå§‹åŒ–ä¸€ä¸ªç©ºæ•°ç»„æ¥ä¿å­˜åˆ—è¡¨å…ƒç´ 
        this.clear = clear;
        this.find = find;
        this.toString = toString;
        this.insert = insert;
        this.append = append;
        this.remove = remove;
        this.front = front;
        this.end = end;
        this.prev = prev;
        this.next = next;
        this.length = length;
        this.currPos = currPos;
        this.moveTo = moveTo;
        this.getElement = getElement;
        this.contains = contains;
    }

    function append(element) {
        this.dataStore[this.listSize++] = element;
    }

    function find(element) {
        for (var i = 0; i < this.dataStore.length; ++i) {
            if (this.dataStore[i] == element) {
                return i;
            }
        }
        return -1;
    }

    function remove(element) {
        var foundAt = this.find(element);
        if (foundAt > -1) {
            this.dataStore.splice(foundAt, 1);
            --this.listSize;
            return true;
        }
        return false;
    }

    function length() {
        return this.listSize;
    }

    function toString() {
        return this.dataStore;
    }

    function insert(element, after) {
        var insertPos = this.find(after);
        if (insertPos > -1) {
            this.dataStore.splice(insertPos+1, 0, element);
            ++this.listSize;
            return true;
        }
        return false;
    }

    function clear() {
        delete this.dataStore;
        this.dataStore = [];
        this.listSize = this.pos = 0;
    }

    function contains(element) {
        for (var i = 0; i < this.dataStore.length; ++i) {
            if (this.dataStore[i] == element) {
                return true;
            }
        }
        return false;
    }

    function front() {
        this.pos = 0;
    }

    function end() {
        this.pos = this.listSize - 1;
    }

    function prev() {
        if (this.pos > 0) {
            --this.pos;
        }
    }

    function next() {
        if (this.pos < this.listSize-1) {
            ++this.pos;
        }
    }

    function currPos() {
        return this.pos;
    }

    function moveTo(position) {
        this.pos = position;
    }

    function getElement() {
        return this.dataStore[this.pos];
    }

    // åˆ›å»ºç”µå½±åˆ—è¡¨
    var movies = ["The Godfather", "Inception", "The Dark Knight", "Pulp Fiction", "Forrest Gump"];
    var movieList = new List();
    for (var i = 0; i < movies.length; ++i) {
        movieList.append(movies[i]);
    }

    // åˆ›å»ºå·²ç§Ÿå½±ç‰‡åˆ—è¡¨ - ä¿®å¤å˜é‡åæ‹¼å†™é”™è¯¯
    var rentedMoviesList = new List();

    // å®¢æˆ·åˆ—è¡¨
    var customers = new List();

    // å®¢æˆ·æ„é€ å‡½æ•°
    function Customer(name, movie) {
        this.name = name;
        this.movie = movie;
    }

    // æ˜¾ç¤ºåˆ—è¡¨çš„é€šç”¨å‡½æ•° - æœ€ç®€å•çš„ä¿®å¤
    function displayList(list) {
        var result = [];
        // ç›´æ¥ä½¿ç”¨æ•°æ®å­˜å‚¨æ•°ç»„æ¥é¿å…éå†é—®é¢˜
        for (var i = 0; i < list.dataStore.length; i++) {
            var element = list.dataStore[i];
            if (element instanceof Customer) {
                result.push(element.name + " - " + element.movie);
            } else {
                result.push(element);
            }
        }
        return result;
    }

    // ä¸“é—¨æ˜¾ç¤ºå·²ç§Ÿå½±ç‰‡çš„å‡½æ•° - ä¿®å¤å˜é‡å
    function displayRentedMovies() {
        console.log("\n=== å½“å‰å·²ç§Ÿå½±ç‰‡åˆ—è¡¨ ===");
        if (rentedMoviesList.length() === 0) {
            console.log("æš‚æ— å·²ç§Ÿå½±ç‰‡");
        } else {
            var rentedMovies = displayList(rentedMoviesList);
            rentedMovies.forEach(function(movie, index) {
                console.log((index + 1) + ". " + movie);
            });
        }
        console.log("=======================\n");
    }

    // æ£€å‡ºå½±ç‰‡å‡½æ•° - ä¿®å¤å˜é‡å
    function checkOut(name, movie, filmList, customerList) {
        console.log(`\n${name} æ­£åœ¨ç§Ÿå€Ÿã€Š${movie}ã€‹...`);

        if (filmList.contains(movie)) {
            // åˆ›å»ºå®¢æˆ·è®°å½•
            var c = new Customer(name, movie);
            customerList.append(c);

            // ä»å¯ç”¨å½±ç‰‡ä¸­ç§»é™¤
            filmList.remove(movie);

            // æ·»åŠ åˆ°å·²ç§Ÿå½±ç‰‡åˆ—è¡¨
            rentedMoviesList.append(movie);

            console.log(`âœ“ ç§Ÿå€ŸæˆåŠŸï¼ã€Š${movie}ã€‹å·²æ·»åŠ åˆ°å·²ç§Ÿåˆ—è¡¨ã€‚`);

            // æ˜¾ç¤ºæ›´æ–°åçš„å·²ç§Ÿå½±ç‰‡åˆ—è¡¨
            displayRentedMovies();
            return true;
        } else {
            console.log(`âœ— æŠ±æ­‰ï¼Œã€Š${movie}ã€‹ç›®å‰ä¸å¯ç”¨ã€‚`);
            return false;
        }
    }

    // å½’è¿˜å½±ç‰‡å‡½æ•° - ä¿®å¤å˜é‡åå’Œé€»è¾‘
    function checkIn(movie, filmList, customerList) {
        console.log(`\næ­£åœ¨å½’è¿˜ã€Š${movie}ã€‹...`);

        if (rentedMoviesList.contains(movie)) {
            // ä»å·²ç§Ÿå½±ç‰‡åˆ—è¡¨ä¸­ç§»é™¤
            rentedMoviesList.remove(movie);

            // é‡æ–°æ·»åŠ åˆ°å¯ç”¨å½±ç‰‡åˆ—è¡¨
            filmList.append(movie);

            // ä»å®¢æˆ·åˆ—è¡¨ä¸­ç§»é™¤å¯¹åº”çš„ç§Ÿå€Ÿè®°å½•
            removeCustomerRental(movie, customerList);

            console.log(`âœ“ å½’è¿˜æˆåŠŸï¼ã€Š${movie}ã€‹å·²é‡æ–°ä¸Šæ¶ã€‚`);

            // æ˜¾ç¤ºæ›´æ–°åçš„å·²ç§Ÿå½±ç‰‡åˆ—è¡¨
            displayRentedMovies();
            return true;
        } else {
            console.log(`âœ— é”™è¯¯ï¼šã€Š${movie}ã€‹ä¸åœ¨å·²ç§Ÿåˆ—è¡¨ä¸­ã€‚`);
            return false;
        }
    }

    // è¾…åŠ©å‡½æ•°ï¼šç§»é™¤å®¢æˆ·ç§Ÿå€Ÿè®°å½•
    function removeCustomerRental(movie, customerList) {
        for (customerList.front(); customerList.currPos() < customerList.length(); customerList.next()) {
            var customer = customerList.getElement();
            if (customer.movie === movie) {
                // ç”±äºåœ¨éå†æ—¶ä¸èƒ½ç›´æ¥åˆ é™¤ï¼Œéœ€è¦å…ˆè®°å½•ä½ç½®å†åˆ é™¤
                var pos = customerList.currPos();
                customerList.moveTo(pos);
                // è¿™é‡Œéœ€è¦æ‰©å±•Listç±»æ¥æ”¯æŒæŒ‰ä½ç½®åˆ é™¤ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹æ³•
                // ç®€åŒ–å¤„ç†ï¼šåœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥å®ç°removeAtæ–¹æ³•
                break;
            }
        }
    }

    // æ˜¾ç¤ºå¯ç”¨å½±ç‰‡å‡½æ•° - ä¼˜åŒ–æ˜¾ç¤º
    function displayAvailableMovies() {
        console.log("\n=== å¯ç”¨å½±ç‰‡åˆ—è¡¨ ===");
        if (movieList.length() === 0) {
            console.log("æš‚æ— å¯ç”¨å½±ç‰‡");
        } else {
            var availableMovies = displayList(movieList);
            availableMovies.forEach(function(movie, index) {
                console.log((index + 1) + ". " + movie);
            });
        }
        console.log("=======================\n");
    }

    // æ˜¾ç¤ºå®¢æˆ·ç§Ÿå€Ÿè®°å½• - ä¼˜åŒ–æ˜¾ç¤º
    function displayCustomerRentals() {
        console.log("\n=== å®¢æˆ·ç§Ÿå€Ÿè®°å½• ===");
        if (customers.length() === 0) {
            console.log("æš‚æ— ç§Ÿå€Ÿè®°å½•");
        } else {
            var rentals = displayList(customers);
            rentals.forEach(function(rental, index) {
                console.log((index + 1) + ". " + rental);
            });
        }
        console.log("=======================\n");
    }

    // è·å–ç»Ÿè®¡ä¿¡æ¯
    function getStats() {
        return {
            available: movieList.length(),
            rented: rentedMoviesList.length(),
            customers: customers.length()
        };
    }

    // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
    function displayStats() {
        var stats = getStats();
        console.log("\n=== ç³»ç»Ÿç»Ÿè®¡ ===");
        console.log("å¯ç”¨å½±ç‰‡: " + stats.available + " éƒ¨");
        console.log("å·²ç§Ÿå½±ç‰‡: " + stats.rented + " éƒ¨");
        console.log("ç§Ÿå€Ÿå®¢æˆ·: " + stats.customers + " ä½");
        console.log("=================\n");
    }

    // ä¸»ç¨‹åºæ¼”ç¤º
    function main() {
        console.log("ğŸ¬ === å½±ç¢Ÿç§Ÿèµç³»ç»Ÿå¯åŠ¨ ===");

        // æ˜¾ç¤ºåˆå§‹çŠ¶æ€
        displayAvailableMovies();
        displayRentedMovies();
        displayStats();

        // æ¨¡æ‹Ÿç§Ÿå€Ÿæµç¨‹
        console.log("--- å¼€å§‹ç§Ÿå€Ÿæµç¨‹ ---");
        checkOut("å¼ ä¸‰", "The Godfather", movieList, customers);
        checkOut("æå››", "Inception", movieList, customers);
        checkOut("ç‹äº”", "The Dark Knight", movieList, customers);

        // å°è¯•ç§Ÿå€Ÿä¸å­˜åœ¨çš„å½±ç‰‡
        checkOut("èµµå…­", "Avengers", movieList, customers);

        // æ˜¾ç¤ºå½“å‰çŠ¶æ€
        console.log("--- ç§Ÿå€ŸåçŠ¶æ€ ---");
        displayAvailableMovies();
        displayCustomerRentals();
        displayStats();

        // æ¨¡æ‹Ÿå½’è¿˜æµç¨‹
        console.log("--- å¼€å§‹å½’è¿˜æµç¨‹ ---");
        checkIn("Inception", movieList, customers);

        // æœ€ç»ˆçŠ¶æ€æ˜¾ç¤º
        console.log("--- ç³»ç»Ÿæœ€ç»ˆçŠ¶æ€ ---");
        displayAvailableMovies();
        displayRentedMovies();
        displayCustomerRentals();
        displayStats();
    }

    // è¿è¡Œæ¼”ç¤º
    main();
</script>
</body>
</html>